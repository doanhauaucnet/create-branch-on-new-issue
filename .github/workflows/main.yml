name: Create Branch on New Issue
on:
  issues:
    types: [opened, assigned]
  issue_comment:
    types: [created]
  pull_request:
    types: [opened, closed]

permissions:
  contents: write

jobs:
  create_branch_job:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v2
      - name: Create Branch
        env:
          PAT: ${{ secrets.GITHUB_TOKEN }}
        run: |
          issue_title=$(jq -r '.issue.title' $GITHUB_EVENT_PATH)
          event_name=$(echo $GITHUB_EVENT_NAME | tr '[:upper:]' '[:lower:]')
          event_type=$(echo $GITHUB_EVENT_NAME | tr '[:upper:]' '[:lower:]')
          sanitized_issue_title=$(echo "$issue_title" | tr -cd '[:alnum:]\n' | tr '[:space:]' '_')
          branch_name="${event_name}-${sanitized_issue_title}-${event_type}"
          echo "Branch Name: $branch_name"
          git checkout -b $branch_name
          git push origin $branch_name